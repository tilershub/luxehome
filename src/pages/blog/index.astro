---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Nav from '../../components/Nav.astro';
import Footer from '../../components/Footer.astro';

const posts = (await getCollection('blog')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const categories = [...new Set(posts.map((p) => p.data.category))];
---

<Layout
  title="Tiling & Bathroom Blog | TILERSHUB Sri Lanka"
  description="Expert advice on floor tiling, bathroom renovation, tile selection, and more. Practical guides from professional tilers in Sri Lanka."
>
  <Nav />

  <main>
    <header class="blog-hero">
      <div class="blog-hero-inner">
        <div class="stag">Insights &amp; Guides</div>
        <h1>Tiling &amp; Bathroom <em>Blog</em></h1>
        <p class="blog-hero-desc">
          Practical advice on tiles, renovation, materials, and maintenance — straight from the team that does this work every day across Sri Lanka.
        </p>
      </div>
    </header>

    <section class="blog-section">
      <div class="blog-container">

        <aside class="blog-sidebar">
          <div class="sidebar-block">
            <div class="sidebar-label">Categories</div>
            <ul class="cat-list">
              {categories.map((cat) => (
                <li class="cat-item">{cat}</li>
              ))}
            </ul>
          </div>

          <div class="sidebar-block cta-block">
            <div class="cta-icon">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z"/>
                <path d="M12 0C5.373 0 0 5.373 0 12c0 2.143.566 4.148 1.553 5.887L0 24l6.296-1.529A11.946 11.946 0 0012 24c6.627 0 12-5.373 12-12S18.627 0 12 0zm0 21.818a9.818 9.818 0 01-5.001-1.368l-.36-.213-3.733.906.946-3.643-.234-.374A9.818 9.818 0 1112 21.818z"/>
              </svg>
            </div>
            <div class="cta-title">Need a quote?</div>
            <p class="cta-text">WhatsApp us with your project details for a free, honest estimate.</p>
            <a
              href="https://wa.me/94774503744?text=Hello%2C%20I%20would%20like%20a%20free%20quote."
              class="btn-primary"
            >
              WhatsApp Us
            </a>
          </div>
        </aside>

        <div class="posts-grid">
          {posts.map((post, i) => (
            <article class={`post-card reveal ${i === 0 ? 'post-card--featured' : ''}`}>
              <a href={`/blog/${post.id.replace(/\.mdx?$/, '')}`} class="post-card-link">
                <div class="post-meta">
                  <span class="post-cat">{post.data.category}</span>
                  <span class="post-dot">·</span>
                  <span class="post-time">{post.data.readingTime}</span>
                </div>
                <h2 class="post-title">{post.data.title}</h2>
                <p class="post-desc">{post.data.description}</p>
                <div class="post-footer">
                  <time class="post-date" datetime={post.data.pubDate.toISOString()}>
                    {post.data.pubDate.toLocaleDateString('en-LK', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric',
                    })}
                  </time>
                  <span class="post-read">Read article →</span>
                </div>
              </a>
            </article>
          ))}
        </div>

      </div>
    </section>
  </main>

  <Footer />
</Layout>

<style>
  /* ── Hero ── */
  .blog-hero {
    background: var(--charcoal);
    padding: 7rem 2rem 5rem;
    text-align: center;
  }

  .blog-hero-inner {
    max-width: 680px;
    margin: 0 auto;
  }

  .blog-hero .stag {
    color: var(--clay);
    margin-bottom: 1rem;
  }

  .blog-hero .stag::before {
    background: var(--clay);
  }

  .blog-hero h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(2.2rem, 4vw, 3.5rem);
    font-weight: 900;
    color: var(--cream);
    line-height: 1.1;
    margin-bottom: 1.2rem;
  }

  .blog-hero h1 em {
    font-style: italic;
    color: var(--clay);
  }

  .blog-hero-desc {
    font-size: .95rem;
    font-weight: 300;
    line-height: 1.8;
    color: rgba(245, 240, 232, .7);
    max-width: 54ch;
    margin: 0 auto;
  }

  /* ── Layout ── */
  .blog-section {
    padding: 5rem 2rem 6rem;
  }

  .blog-container {
    max-width: 1200px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr 280px;
    gap: 4rem;
    align-items: start;
  }

  /* ── Posts grid ── */
  .posts-grid {
    display: grid;
    gap: 1.5rem;
    order: -1;
  }

  .post-card {
    background: #fff;
    border: 1px solid var(--stone);
    border-radius: 4px;
    transition: box-shadow .2s, transform .2s;
  }

  .post-card:hover {
    box-shadow: 0 8px 32px rgba(30, 26, 23, .1);
    transform: translateY(-2px);
  }

  .post-card--featured {
    border-color: var(--clay);
    border-width: 2px;
  }

  .post-card-link {
    display: block;
    padding: 2rem 2.2rem;
    text-decoration: none;
    color: inherit;
  }

  .post-meta {
    display: flex;
    align-items: center;
    gap: .5rem;
    margin-bottom: .8rem;
  }

  .post-cat {
    font-size: .75rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: .1em;
    color: var(--clay);
  }

  .post-dot {
    color: var(--stone);
    font-size: .75rem;
  }

  .post-time {
    font-size: .75rem;
    color: var(--warm-gray);
  }

  .post-title {
    font-family: 'Playfair Display', serif;
    font-size: clamp(1.2rem, 2vw, 1.5rem);
    font-weight: 700;
    line-height: 1.25;
    color: var(--charcoal);
    margin-bottom: .75rem;
    letter-spacing: -.01em;
  }

  .post-card--featured .post-title {
    font-size: clamp(1.4rem, 2.5vw, 1.8rem);
  }

  .post-desc {
    font-size: .88rem;
    font-weight: 300;
    line-height: 1.72;
    color: var(--warm-gray);
    margin-bottom: 1.4rem;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .post-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 1rem;
    border-top: 1px solid var(--stone);
  }

  .post-date {
    font-size: .75rem;
    color: var(--warm-gray);
  }

  .post-read {
    font-size: .82rem;
    font-weight: 500;
    color: var(--clay);
  }

  /* ── Sidebar ── */
  .blog-sidebar {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    position: sticky;
    top: 5.5rem;
  }

  .sidebar-block {
    background: #fff;
    border: 1px solid var(--stone);
    border-radius: 4px;
    padding: 1.6rem;
  }

  .sidebar-label {
    font-size: .75rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: .12em;
    color: var(--clay);
    margin-bottom: 1rem;
  }

  .cat-list {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: .5rem;
  }

  .cat-item {
    font-size: .88rem;
    color: var(--warm-gray);
    padding: .45rem .6rem;
    border-radius: 3px;
    background: var(--off-white);
  }

  /* ── Sidebar CTA ── */
  .cta-block {
    background: var(--charcoal);
    border-color: var(--charcoal);
  }

  .cta-icon {
    color: var(--clay);
    margin-bottom: .8rem;
  }

  .cta-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.15rem;
    font-weight: 700;
    color: var(--cream);
    margin-bottom: .5rem;
  }

  .cta-text {
    font-size: .85rem;
    font-weight: 300;
    line-height: 1.65;
    color: rgba(245, 240, 232, .65);
    margin-bottom: 1.2rem;
  }

  .cta-block .btn-primary {
    width: 100%;
    justify-content: center;
  }

  /* ── Responsive ── */
  @media (max-width: 900px) {
    .blog-container {
      grid-template-columns: 1fr;
    }

    .blog-sidebar {
      position: static;
      order: 1;
    }
  }

  @media (max-width: 600px) {
    .blog-hero {
      padding: 6rem 1.5rem 3.5rem;
    }

    .post-card-link {
      padding: 1.5rem;
    }
  }
</style>
